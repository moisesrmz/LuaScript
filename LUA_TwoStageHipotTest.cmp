cmpTwoStageHipot = {}
cmpTwoStageHipot.description = "Two-Stage Hipot with IR and logging of pass/fail attempts"

cmpTwoStageHipot.params = {
    {"Test Points", "pointlist", 0},

    -- First test parameters
    {"DWV Voltage 1", "number", 950},
    {"DWV Current 1", "number", 0.0015},
    {"DWV Duration 1 (cycles)", "number", 3},
    {"IR Voltage 1", "number", 950},
    {"IR Resistance 1", "number", 250000000},
    {"IR Duration 1", "number", 0.0100},

    -- Second test parameters
    {"DWV Voltage 2", "number", 950},
    {"DWV Current 2", "number", 0.0015},
    {"DWV Duration 2 (cycles)", "number", 3},
    {"IR Voltage 2", "number", 950},
    {"IR Resistance 2", "number", 250000000},
    {"IR Duration 2", "number", 0.0100},

    {"Frequency", "number", 60},
    {"Soak Time", "number", 0.000},
    {"Soak Until Good", "number", 0}
}

function cmpTwoStageHipot.test(points,
    dwv1, current1, cycles1, irVolt1, irRes1, irTime1,
    dwv2, current2, cycles2, irVolt2, irRes2, irTime2,
    freq, soak, soakUntilGood)

    local ptList = ""
    for i = 1, #points do
        ptList = ptList .. points[i] .. " "
    end

    -- First attempt
	local iDNum = DialogOpen("Warning: High voltage")
    local result1, _ = HipotNetsTiedToPoints(
        ptList, "AC", freq, dwv1, current1, cycles1,
        irVolt1, irRes1, irTime1, soak, soakUntilGood)
    DialogClose(iDNum)
	
    if result1 == 0 then
        return 0
    end

    -- Second attempt
	iDNum = DialogOpen("Warning: High voltage")
    local result2, _ = HipotNetsTiedToPoints(
        ptList, "AC", freq, dwv2, current2, cycles2,
        irVolt2, irRes2, irTime2, soak, soakUntilGood)
    DialogClose(iDNum)
    if result2 == 0 then
        return 0
    else
        return 1, "Failed both tests, Points: [" .. ptList .. "] are bad"
    end
end
